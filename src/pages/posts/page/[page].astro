---
import { getCollection, CollectionEntry } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Page } from "astro";
import PostList from "@/components/PostList.astro";
import { postsDefaultSortFunc } from "../../../content/utils";

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection("posts");
  return paginate(allPosts.sort(postsDefaultSortFunc), { pageSize: 10 });
}

interface Props {
  page: Page<CollectionEntry<"posts">>;
}

const { page } = Astro.props;
const posts = page.data;

const pageSize = 10;

const paginations = Array.from({ length: page.lastPage }, (_, i) => i + 1);
---

<BaseLayout title="abekoh's tech blog">
  <PostList posts={posts} />
  <nav>
    <div class="flex justify-center py-2">
      <ul class="inline-flex items-center text-base text-gray-900">
        <li>
          <a href={page.url.prev} class="px-3 py-2 leading-tight">&lt;</a>
        </li>
        {
          paginations.map((i) =>
            i === page.currentPage ? (
              <li>
                <a
                  class="px-3 py-2 leading-tight bg-gray-100 rounded"
                >
                  {i}
                </a>
              </li>
            ) : (
              <li>
                <a href={`/posts/page/${i}`} class="px-3 py-2 leading-tight">
                  {i}
                </a>
              </li>
            )
          )
        }
        <li>
          <a href={page.url.next} class="px-3 py-2 leading-tight">&gt;</a>
        </li>
      </ul>
    </div>
  </nav>
</BaseLayout>
