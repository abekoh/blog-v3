---
slug: 'setup-vpn'
title: 'è‡ªå®…ã¨Google Cloud VPCã‚’VPNã§ç¹‹ã„ã§ã¿ã‚‹'
summary: 'IPSec VPNã§è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨Google Cloud VPCã‚’ç¹‹ãä»•çµ„ã¿ã‚’æ•´ãˆã¦ã¿ã¾ã—ãŸã€‚'
categories: [ 'tech' ]
tags: [ 'network', 'gcp' ]
publishedAt: 2024-10-25T22:40:00.000+09:00
modifiedAt:
draft: false
isHtml: false
---

## ã¯ã˜ã‚ã«

æˆ‘ãŒå®¶ã«ã¯æ•°å¹´å‰ã«çµ„ã‚“ã ã€ŒGeForce RTX 3080æ­è¼‰ã®ã‚²ãƒ¼ãƒŸãƒ³ã‚°PCã€ãŒã‚ã‚‹ã‚ã‘ã§ã™ãŒã€æœ€è¿‘ã¯PCã‚²ãƒ¼ãƒ ã‚’ãã“ã¾ã§ã‚„ã‚‰ãšã€ãã‚Œãªã‚Šã®GPUã‚ã‚‹ã®ã«ã‚‚ã£ãŸã„ãªã„ãªã¨ã„ã†çŠ¶æ…‹ã§ã™ã€‚

æœ€è¿‘ã¯ãƒ­ãƒ¼ã‚«ãƒ«LLMã®æ€§èƒ½ã‚‚è‰¯ããªã‚Šã€ã›ã£ã‹ããªã®ã§ãã‚Œãªã‚Šã®GPUç©ã‚“ã ã‚²ãƒ¼ãƒŸãƒ³ã‚°PCã‚’AIãƒã‚·ãƒ³ã«ã—ã¦æœ‰åŠ¹æ´»ç”¨ã§ããªã„ã‹ãªã€ã¨æ€ã„ã€‚ãã‚Œãªã‚‰è‡ªå®…ä»¥å¤–ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰ã‚‚å‘¼ã³å‡ºã›ã‚‹ã¨å¬‰ã—ã„ã ã‚ã†ãªãƒ¼ã¨å¦„æƒ³ã—ã¦ã¾ã—ãŸã€‚

ãã®ã¯ã˜ã‚ã®ä¸€æ­©ã¨ã—ã¦ã€IPSec VPNã§è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨Google Cloud VPCã‚’ç¹‹ãä»•çµ„ã¿ã‚’æ•´ãˆã¦ã¿ã¾ã—ãŸã€‚ãã®ãƒ­ã‚°ã§ã™ã€‚

## Overview

å…¨ä½“ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã“ã¡ã‚‰ã€‚Google Cloudã®ã»ã†ã¯ã¨ã‚Šã‚ãˆãšç–é€šç¢ºèªã®ãŸã‚ã«Compute Engineã®ã¿ã€‚è‡ªå®…ã®ã»ã†ã¯YAMAHAãƒ«ãƒ¼ã‚¿ã‚’ä¸­å¿ƒã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã—ã¦ã¿ã¦ã¾ã™ã€‚

![Overview](/assets/setup-vpn-overview.png)


## è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ·æ–°

è‡ªå®…ã®å›ç·šã¯Nuroå…‰ã§ã€ä»Šã¾ã§ZTE F660Aã¨ã„ã†ç«¯æœ«ã«ONUã€ãƒ«ãƒ¼ã‚¿ã€Wi-Fiã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã™ã¹ã¦ã®å½¹å‰²ã‚’ä»»ã›ã¦ã„ã¾ã—ãŸã€‚
Google Cloudã¨ã®æ‹ ç‚¹é–“VPNã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ãŸã‚ã«ã¯IPSecã‚’ç”¨ã„ãŸVPNã«å¯¾å¿œã—ãŸãƒ«ãƒ¼ã‚¿ãŒå¿…è¦ã§ã€F660Aã¯ãã‚Œã«ã¯å¯¾å¿œã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ã¨ã„ã†ã‹å®¶åº­å‘ã‘ãƒ«ãƒ¼ã‚¿ã¯IPSec VPNã«å¯¾å¿œã—ã¦ã„ã‚‹ã»ã†ãŒçã—ã„ã§ã™ã€‚

ãã“ã§ç•Œéšˆã§ã¯åé«˜ã„æ¥­å‹™ç”¨ãƒ«ãƒ¼ã‚¿ã€YAMAHAè£½ã®ãƒ«ãƒ¼ã‚¿ã«æ‰‹ã‚’å‡ºã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ãªã‚“ã¨ãªãæ†§ã‚ŒãŒã‚ã£ãŸã®ã§è‰¯ã„æ©Ÿä¼šã§ã™ã€‚

å…¥æ‰‹ã—ãŸã®ã¯ã“ã¡ã‚‰[RTX830](https://network.yamaha.com/products/routers/rtx830/index)ã€‚å¸Œæœ›å°å£²ä¾¡æ ¼ãªã‚“ã¨101,200å††(ç¨è¾¼)ï¼
â€¦ã“ã®å€¤æ®µã ã¨æµçŸ³ã«ãªã€ã¨ã¯æ€ã„ã¾ã—ãŸãŒã€ãƒ¡ãƒ«ã‚«ãƒªã§æ¢ã™ã¨ä¸­å¤2ä¸‡å††ç¨‹åº¦ã®å‡ºå“ãŒãŸãã•ã‚“ã‚ã£ãŸã®ã§è³¼å…¥ã€‚æ¥­å‹™ç”¨ã®å®‰å®šé«˜æ©Ÿèƒ½ãªãƒ«ãƒ¼ã‚¿ãŒ2ä¸‡ã¯ãŠè²·ã„å¾—ãªæ°—ãŒã—ã¾ã™ã€‚

ãƒ«ãƒ¼ã‚¿ãŒåˆ°ç€ã—ã¦ã€ã„ã–è¨­å®šé–‹å§‹ã€‚F660Aã¯ONUæ©Ÿèƒ½ã®ã¿ã«é™å®šã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ã™ã¹ã¦RTX830ã®ã»ã†ã§è¡Œã£ã¦ã‚‚ã‚‰ã†ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
ã“ã®ã‚ãŸã‚Šã®è¨­å®šã¯å…ˆäººã®ãƒ­ã‚°ãŒãŸãã•ã‚“è¦‹ã¤ã‹ã£ãŸã®ã§å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

- [Nuroå…‰ + RTX1200 ã§ VPNãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆä¸€éƒ¨åˆ¶é™ã‚ã‚Šï¼‰- é€¸èˆ¬ã®èª¤å®¶åº­ å‘ã‘æƒ…å ± - ã‚‚ã®ãã‚ã¼ã£ãã™](https://mono96.jp/network/yamaha/41783/)
- [Nuroå…‰ã®ONUã«è‡ªå‰ãƒ«ãƒ¼ã‚¿ã‚’æ¥ç¶šã™ã‚‹ - TALKEYBOID Blog](https://talkeyboid.com/entry/2023/01/05/013001)
- [NUROå…‰ã§F660Aã¸ã®æ¥ç¶šå°æ•°ãŒ10å°ã‚’è¶…ãˆã‚‹ã¨ä¸å®‰å®šã«ãªã‚‹äº‹è±¡ã‚’è§£æ±ºã™ã‚‹ - ã†ã£ã‹ã‚Šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãƒ¡ãƒ¢](https://entropiajp.hatenablog.com/entry/2022/09/11/202536)

ã‚„ã£ãŸã“ã¨ã¾ã¨ã‚ã‚‹ã¨ã–ã£ãã‚Šâ†“

- F660A/LANã¨RTX830/WANã‚’ã¤ãªã
- F660Aã®ç®¡ç†ç”»é¢ã«ã¦
  - Wi-Fiã¯OFFã€DHCPã‚‚OFF
  - RTX830ã‚’MACã‚¢ãƒ‰ãƒ¬ã‚¹æŒ‡å®šã§192.168.1.2ã«IPå›ºå®š
  - DMZã‚’è¨­å®šã—ã¦ã™ã¹ã¦ã®IPãƒ‘ã‚±ãƒƒãƒˆãŒRTX830ã«å±Šãã‚ˆã†ã«
- RTX830ã®ç®¡ç†ç”»é¢ã«ã¦
  - ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æ¥ç¶šã§ã€ä»¥ä¸‹ã®è¨­å®šã«
    - æ¥ç¶šç¨®åˆ¥: DHCP ã€ã¾ãŸã¯å›ºå®šIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚‹æ¥ç¶š
    - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹: WAN

ã¾ãŸã€Wi-Fiã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã®ãŸã‚ã«[Aterm WX1500HP](https://www.aterm.jp/product/atermstation/product/warpstar/wx1500hp/)ã‚’è³¼å…¥ã€ãƒ–ãƒªãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰ã§ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚

ä»¥ä¸ŠãŒè‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åˆ·æ–°ã§ã™ã€‚

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">YAMAHAãƒ«ãƒ¼ã‚¿å°å…¥ã—ãŸã€‚ã“ã‚Œã§æˆ‘ãŒå®¶ã‚‚é€¸èˆ¬ã®èª¤å®¶åº­ <a href="https://t.co/aOJvIiMMNN">pic.twitter.com/aOJvIiMMNN</a></p>&mdash; abekoh (@abekoh_my) <a href="https://twitter.com/abekoh_my/status/1841411320739938346?ref_src=twsrc%5Etfw">October 2, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

ã¤ã„ã§ã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€”åˆ‡ã‚Œã‚‹å•é¡Œã‚‚è§£æ±ºã—ãŸã£ã½ã„ã€‚

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">YouTube LiveãŒåˆ‡ã‚Œã¾ãã‚‹å•é¡ŒãŒãªããªã£ã¦å¿«é©<br>YAMAHAãƒ«ãƒ¼ã‚¿ã ã‹ã‚‰ã€ã¨ã„ã†ã‚ˆã‚ŠONUã¨ãƒ«ãƒ¼ã‚¿ã‚’åˆ†é›¢ã•ã›ãŸã‹ã‚‰ãªæ°—ã¯ã™ã‚‹ã‘ã©</p>&mdash; abekoh (@abekoh_my) <a href="https://twitter.com/abekoh_my/status/1842823471338033349?ref_src=twsrc%5Etfw">October 6, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


## VPNã®è¨­å®š

ãã‚Œã§ã¯æœ¬é¡Œã€VPNã®è¨­å®šã§ã™ã€‚æ‹ ç‚¹é–“VPNã¨ã„ã†ã‚‚ã®ã§ã€ãã®ä¸­ã§ã‚‚ç¾ä»£ã§ä¸»æµãªIPSecã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

IPSecé€šä¿¡ã‚’è¡Œã†ãŸã‚ã«ã€

- ã‚°ãƒ­ãƒ¼ãƒãƒ«IPå›ºå®š or DDNSè¨­å®š
- IKEv2(éµäº¤æ›ãƒ»èªè¨¼ã®ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«)ã®è«¸ã€…ã®èªè¨¼è¨­å®šã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¨­å®š

ãªã©ã®è¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

ã¾ãšã¯è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®RTX830å´ã‹ã‚‰ã€‚YAMAHAãƒ«ãƒ¼ã‚¿ã«ã¯[ãƒãƒƒãƒˆãƒœãƒ©ãƒ³ãƒDNSã‚µãƒ¼ãƒ“ã‚¹](https://network.yamaha.com/knowledge/netvolantedns)ã¨ã„ã†ã€å‹•çš„ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«IPãŒå¤‰åŒ–ã—ã¦ã—ã¾ã†ç’°å¢ƒã§ã‚‚ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šã§ãã‚‹DDNSã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚‹ã®ã§ã™ãŒã€èª¿ã¹ã‚‹é™ã‚ŠNuroå›ç·šæ‰±ã†ã“ã®æ§‹æˆã ã¨åˆ©ç”¨ã§ããªã„æ¨¡æ§˜ã€‚

ãŸã èª¿ã¹ãŸæ„Ÿã˜ã€æˆ‘ãŒå®¶ã®Nuroå›ç·šã¯ã»ã¼ã‚°ãƒ­ãƒ¼ãƒãƒ«IPãŒå¤‰åŒ–ã—ã¦ã„ãªã•ãã†ãªã®ã§ã€ã¨ã‚Šã‚ãˆãšãã®ã¾ã¾ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚DDNSã‚‚Cloudflare DNSã®APIä½¿ãˆã°å®Ÿç¾ã§ããã†ã§ã—ãŸã€‚

è¨­å®šã¯RTX830ã®GUIã§ã‚‚ã§ããã†ã«è¦‹ãˆã¾ã—ãŸãŒã€IKEv2ã«å¯¾å¿œã—ãŸè¨­å®šãŒã§ããªã•ãã†ã ã£ãŸã®ã§ã‚³ãƒãƒ³ãƒ‰ã§è¨­å®šã€‚

ã“ã¡ã‚‰ã®æ›¸ç±ã¨ã€

- [ãƒ¤ãƒãƒãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã¤ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆVPN [ç¬¬5ç‰ˆ] | ãƒã‚¤ãƒŠãƒ“ãƒ–ãƒƒã‚¯ã‚¹](https://book.mynavi.jp/ec/products/detail/id=87851)

ã“ã‚Œã‚‰ãƒšãƒ¼ã‚¸ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

- [YAMAHAãƒ«ãƒ¼ã‚¿ã€€ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹VPNï¼ˆIKEv2ï¼‰ã®è¨­å®š - æ ªå¼ä¼šç¤¾ãƒãƒ‡ã‚£ã‚¢ â”‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ˜æ—¥ã‚’å‰µã‚‹â”‚ç¾¤é¦¬](https://www.nedia.ne.jp/blog/2024/02/27/22802)
- [ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹VPN(IKEv2)ã®è¨­å®šæ‰‹é †](https://www.rtpro.yamaha.co.jp/RT/docs/ipsec/ikev2_ras/index.html)


ã–ã£ãã‚Šã“ã‚“ãªæ„Ÿã˜ã®è¨­å®šã«ãªã‚Šã¾ã—ãŸã€‚

```
ip filter 201000 pass * 192.168.100.1 esp
ip filter 201001 pass * 192.168.100.1 udp * 500
ip filter 201002 pass * 192.168.100.1 udp * 4500
ip lan2 secure filter in {ã‚‚ã¨ã‚‚ã¨å­˜åœ¨ã—ã—ã¦ã„ãŸãƒ•ã‚£ãƒ«ã‚¿} 201000 201001 201002

tunnel select 1
 description tunnel my-tunnel
 ipsec tunnel 1
  ipsec sa policy 1 1 esp aes256-cbc sha256-hmac
  ipsec ike version 1 2
  ipsec ike always-on 1 on
  ipsec ike encryption 1 aes256-cbc
  ipsec ike group 1 modp2048
  ipsec ike hash 1 sha256
  ipsec ike keepalive log 1 on
  ipsec ike keepalive use 1 on rfc4306
  ipsec ike local address 1 192.168.100.1
  ipsec ike local name 1 {è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IP} ipv4-addr
  ipsec ike nat-traversal 1 on
  ipsec ike pfs 1 on
  ipsec ike pre-shared-key 1 text {äº‹å‰å…±æœ‰ã‚­ãƒ¼}
  ipsec ike remote address 1 {Google Cloudã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IP}
  ipsec ike remote name 1 {Google Cloudã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IP} ipv4-addr
 ip tunnel tcp mss limit auto
tunnel enable 1
ipsec auto refresh on
ipsec ike mode-cfg address pool 1 192.168.100.200-192.168.100.215/24

nat descriptor type 200 masquerade
nat descriptor address outer 200 primary
nat descriptor masquerade static 200 1 192.168.100.1 esp
nat descriptor masquerade static 200 2 192.168.100.1 udp 500
nat descriptor masquerade static 200 3 192.168.100.1 udp 4500
```

æ¬¡ã«Google Cloudã®Cloud VPNã®è¨­å®šã€‚Cloud VPNã«ã¯ã€Œé«˜å¯ç”¨æ€§(HA)VPNã€ã¨ã€ŒClassic VPNã€ãŒã‚ã‚Šã¾ã™ãŒã€å€‹äººã§æ‰±ã†ã‚‚ã®ãªã®ã§å®‰ä¾¡ã§ã‚·ãƒ³ãƒ—ãƒ«ãªã€ŒClassic VPNã€ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

[Cloud VPN ã®æ¦‚è¦ Â |Â  Google Cloud](https://cloud.google.com/network-connectivity/docs/vpn/concepts/overview?hl=ja#classic-vpn)

Terraformã§è¨­å®šã—ãŸä¾‹ãŒä»¥ä¸‹ã®é€šã‚Šã€‚VPCã€ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã¯åˆ¥é€”ç”¨æ„ã—ã¦variableã¨ã—ã¦æ¸¡ã™å‰æã§ã™ã€‚

```terraform
# VPCã®ID
variable "network" {
  type    = string
}

# äº‹å‰å…±æœ‰ã‚­ãƒ¼
variable "vpn_tunnel_shared_secret" {
  type    = string
}

# è‡ªå®…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IP
variable "vpn_home_ip" {
  type    = string
}

# Google Cloudã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IP
variable "vpn_static_ip" {
  type    = string
}

resource "google_compute_vpn_gateway" "vpn_gateway" {
  name    = "my-vpn-gateway"
  network = var.network
}

resource "google_compute_vpn_tunnel" "vpn_tunnel" {
  ike_version                     = "2"
  local_traffic_selector          = ["192.168.200.0/24"]
  name                            = "my-tunnel"
  peer_external_gateway_interface = "0"
  peer_ip                         = var.vpn_home_ip
  remote_traffic_selector         = ["192.168.100.0/24"]
  target_vpn_gateway              = google_compute_vpn_gateway.vpn_gateway.self_link
  vpn_gateway_interface           = "0"
  shared_secret                   = var.vpn_tunnel_shared_secret

  depends_on = [
    google_compute_forwarding_rule.allow-esp,
    google_compute_forwarding_rule.allow-udp4500,
    google_compute_forwarding_rule.allow-udp500,
  ]
}

resource "google_compute_route" "vpn_route" {
  dest_range          = "192.168.100.0/24"
  name                = "my-tunnel-route-1"
  network             = var.network
  next_hop_vpn_tunnel = google_compute_vpn_tunnel.vpn_tunnel.self_link
  priority            = "1000"
}

resource "google_compute_forwarding_rule" "allow_esp" {
  all_ports              = "false"
  allow_global_access    = "false"
  ip_address             = var.vpn_static_ip
  ip_protocol            = "ESP"
  is_mirroring_collector = "false"
  load_balancing_scheme  = "EXTERNAL"
  name                   = "my-rule-esp"
  network_tier           = "PREMIUM"
  target                 = google_compute_vpn_gateway.vpn_gateway.self_link
}

resource "google_compute_forwarding_rule" "allow_udp4500" {
  all_ports              = "false"
  allow_global_access    = "false"
  ip_address             = var.vpn_static_ip
  ip_protocol            = "UDP"
  is_mirroring_collector = "false"
  load_balancing_scheme  = "EXTERNAL"
  name                   = "my-rule-udp4500"
  network_tier           = "PREMIUM"
  port_range             = "4500-4500"
  target                 = google_compute_vpn_gateway.vpn_gateway.self_link
}

resource "google_compute_forwarding_rule" "allow_udp500" {
  all_ports              = "false"
  allow_global_access    = "false"
  ip_address             = var.vpn_static_ip
  ip_protocol            = "UDP"
  is_mirroring_collector = "false"
  load_balancing_scheme  = "EXTERNAL"
  name                   = "my-rule-udp500"
  network_tier           = "PREMIUM"
  port_range             = "500-500"
  target                 = google_compute_vpn_gateway.vpn_gateway.self_link
}
```

ã“ã‚Œã§è¦‹äº‹ç–é€šã—ã¾ã—ãŸğŸ‰

æ¥ç¶šã§ãã‚‹ã¨RTX830ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚‚ç¢ºèªã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã•ã‚‰ã«ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹VPNã®è¨­å®šã‚‚ã—ã¦ã¿ã¦ãŠã‚Šã¾ã™ã€‚

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹VPNã€Google Cloudã¨ã®æ‹ ç‚¹é–“VPNã‚‚è¨­å®šã„ã‘ãŸ <a href="https://t.co/sBGIdviXVW">pic.twitter.com/sBGIdviXVW</a></p>&mdash; abekoh (@abekoh_bcky) <a href="https://twitter.com/abekoh_bcky/status/1842935475646193667?ref_src=twsrc%5Etfw">October 6, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

ã¾ãŸã€Google Cloudã®Compute Engine(192.168.200.11)ã‹ã‚‰è‡ªå®…ã®ã‚²ãƒ¼ãƒŸãƒ³ã‚°PC(192.168.100.55)ã§å‹•ã„ã¦ã‚‹[LocalAI](https://localai.io/)ã‚µãƒ¼ãƒã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚‚æˆåŠŸã—ã¾ã—ãŸğŸ‰

```
abekoh@bastion:~$ curl http://192.168.100.55:6502/v1/chat/completions -H "Content-Type: application/json" -d '{
  "model": "meta-llama-3.1-8b-instruct",
  "messages": [{"role": "user", "content": "Please tell me about IPSec VPN"}],
  "temperature": 0.7
}'
{"created":1729785168,"object":"chat.completion","id":"8c61bf2a-101f-495c-9a7d-7c71ed1fe474","model":"meta-llama-3.1-8b-instruct","choices":[{"index":0,"finish_reason":"stop","message":{"role":"assistant","content":"IPSec VPN (Internet Protocol Security Virtual Private Network) is a widely used technology for establishing secure, encrypted connections between two or more networks over the internet. Here's a rundown on how it works and its key components:\n\n**What is IPSec?**\n\nIPSec (Internet Protocol Security) is a suite of protocols designed to provide security and privacy to IP communications. It was developed by the Internet Engineering Task Force (IETF) and is now a standard part of the IP protocol suite.\n\n**How does IPSec VPN work?**\n\nAn IPSec VPN creates a secure \"tunnel\" between two endpoints, typically between a remote user's device and a corporate network or between two sites. Here's a simplified overview of the process:\n\n1. **Key exchange**: The two endpoints agree on a shared secret key, which is used to encrypt and decrypt data.\n2. **IPSec tunnel**: The endpoints establish an IPSec tunnel, which is a secure connection between them.\n3. **Encapsulation**: Data is encapsulated in IPSec packets, which are then encrypted using the shared secret key.\n4. **Transmission**: The encrypted packets are transmitted over the internet.\n5. **Decapsulation**: The receiving endpoint decrypts the packets, which are then reassembled into the original data.\n\n**Key components of IPSec VPN**\n\n1. **Authentication Header (AH)**: Provides authentication and integrity of the data.\n2. **Encapsulating Security Payload (ESP)**: Provides encryption and confidentiality of the data.\n3. **Internet Key Exchange (IKE)**: Manages the key exchange process between endpoints.\n4. **Security Associations (SAs)**: Define the security parameters for the IPSec tunnel, including the shared secret key and encryption algorithms.\n\n**Benefits of IPSec VPN**\n\n1. **Security**: IPSec VPN provides end-to-end encryption and authentication, protecting data from eavesdropping and tampering.\n2. **Confidentiality**: IPSec VPN ensures that data remains confidential, even if it's intercepted during transmission.\n3. **Integrity**: IPSec VPN ensures that data is not modified or tampered with during transmission.\n4. **Scalability**: IPSec VPN can be used to connect multiple sites or remote users, making it a scalable solution.\n\n**Common deployment scenarios for IPSec VPN**\n\n1. **Remote access VPN**: Connects remote users to a corporate network or site.\n2. **Site-to-site VPN**: Connects two or more sites over the internet.\n3. **Extranet VPN**: Connects a company's network to a partner's network or a service provider's network.\n\nI hope this helps you understand IPSec VPN!"}}],"usage":{"prompt_tokens":17,"completion_tokens":541,"total_tokens":558}}
```

## ãŠã‚ã‚Šã«

ç–é€šã§ããŸã¯ã‚ˆã„ã‚‚ã®ã®ã€VPCç¹‹ãã£ã±ãªã—ã ã¨ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒãªãã¨ã‚‚1æ™‚é–“0.05ãƒ‰ãƒ«ã€1æ—¥1.2ãƒ‰ãƒ«ã€1ãƒ¶æœˆ36ãƒ‰ãƒ«=5000å††è¶…ã‹ã‹ã£ã¦ã—ã¾ã„ã¾ã™ã€‚(us-west1ã®å ´åˆ)

å€‹äººã§æ‰•ã†ã«ã¯ã¡ã¨é«˜ã„ã§ã™ã­ã€‚ãªã®ã§åˆ©ç”¨æ™‚ã®ã¿ç¹‹ã’ã‚‰ã‚Œã‚‹ã‚ˆã†ã€`terraform apply`, `terraform destroy`ã™ã‚‹Cloud Runã‚¸ãƒ§ãƒ–ã‚‚ç”¨æ„ã—ã¦ã¿ã¾ã—ãŸã€‚ã“ã‚Œã‚’å‘¼ã³å‡ºã™è‡ªåˆ†ç”¨UIã‚‚ä½œæˆã—ã‚ˆã†ã¨æ¨¡ç´¢ä¸­â€¦

![setup-job](/assets/setup-vpn-jobs.png)

æ§‹ç¯‰ã—ãŸã¯ã„ã„ã‚‚ã®ã®ã€è‚å¿ƒã®ãƒ­ãƒ¼ã‚«ãƒ«LLMã§ä½•ã—ã‚ˆã†ã‹ãªã£ã¦ã¨ã“ã‚ã¯æ±ºã¾ã£ã¦ã„ãªã„æ¨¡æ§˜ã€‚ã¨ã‚‚ã‹ããƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€VPNã«é–¢ã—ã¦çŸ¥è¦‹ãŒæ·±ã¾ã£ãŸã®ã§è‰¯ã—ã¨ã—ã¾ã™ã€‚
